# 影片位置恢復修復 - 測試指南

## ✅ 已修復的問題

1. **播放位置設定時機** - 移到 `loadedmetadata` 事件後執行
2. **暫停儲存** - `pause` 事件現在會立即儲存當前位置
3. **拖曳儲存** - 新增 `seeked` 事件處理手動拖曳進度條
4. **除錯日誌** - 加入 console.log 方便追蹤

## 🧪 測試步驟

### 測試 1：基本恢復測試
1. 重新整理頁面 (Ctrl+F5 或 Cmd+Shift+R)
2. 進入任一課程（例如：個人資料保護法）
3. 播放影片到 **30 秒**
4. **暫停** 影片
5. 按 **F12** 開啟 Console，應該看到：`[進度追蹤] 暫停時儲存位置: 30.x秒`
6. 重新整理頁面
7. 重新進入課程
8. ✅ **預期結果**：影片應該自動跳到 30 秒處，Console 顯示 `[進度追蹤] 恢復播放位置: 30.x秒`

### 測試 2：拖曳進度條測試
1. 進入課程，播放影片
2. 用滑鼠 **拖曳進度條** 到 1 分鐘 (60秒) 處
3. 檢查 Console，應該看到：`[進度追蹤] 拖曳後儲存位置: 60.x秒`
4. 點擊「回首頁」離開
5. 重新進入課程
6. ✅ **預期結果**：影片從 60 秒處開始

### 測試 3：多次暫停續播測試
1. 播放影片到 20 秒 → **暫停** → 離開頁面
2. 重新進入 → 確認從 20 秒開始 → 播放到 40 秒 → **暫停** → 離開
3. 重新進入 → 確認從 40 秒開始 → 播放到 60 秒 → **暫停** → 離開
4. 最後一次進入
5. ✅ **預期結果**：影片從 60 秒處開始

### 測試 4：播放完成測試
1. 選擇一個短影片（或拖曳到接近結束）
2. 播放到影片結束
3. 檢查 Console：`[進度追蹤] 影片播放完畢`
4. 檢查單元按鈕是否顯示 **綠色 ✓**
5. 檢查首頁課程卡片進度條是否更新

### 測試 5：Firebase 資料驗證
1. 開啟 Firebase Console
2. 進入 Firestore Database
3. 找到 `userProgress` collection
4. 找到你的文件（例如：`TEST001_xxx`）
5. 查看 `units[0].lastPosition` 欄位
6. ✅ **預期結果**：數值與你最後暫停/拖曳的位置一致

## 📊 Console 日誌範例

正常運作時，你應該在 Console 看到類似訊息：

```
[進度追蹤] 恢復播放位置: 45.2秒
[進度追蹤] 拖曳後儲存位置: 120.5秒
[進度追蹤] 暫停時儲存位置: 156.8秒
[進度追蹤] 影片播放完畢
```

## 🎯 預期行為總結

修復後，影片位置恢復應該在以下所有情況都正常：
- ✅ 播放中重新整理頁面（最多遺失 10 秒）
- ✅ 暫停後離開（**完全準確**，0 秒遺失）
- ✅ 拖曳進度條後離開（**完全準確**）
- ✅ 多次進出課程
- ✅ 不同單元獨立追蹤

## ⚠️ 注意事項

1. **YouTube 嵌入影片**：仍然無法自動追蹤（瀏覽器限制），需手動標記
2. **需要網路**：儲存到 Firebase 需要網路連線
3. **清除 Cache**：如果發現異常，請嘗試硬性重新整理 (Ctrl+Shift+R)

---

測試完成後，如果一切正常，問題就已經完全修復了！🎉
